<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Biblioteca para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-color: #5636D3; --secondary-color: #FF872C; --success-color: #12A454;
            --danger-color: #E83F5B; --pending-color: #4B90F7; --background-color: #F0F2F5;
            --text-color: #363F5F; --text-light-color: #969CB2; --card-bg-color: #FFFFFF;
            --border-radius: 16px; --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); display: flex; }
        
        /* --- Layout Geral --- */
        .sidebar { width: 260px; background-color: var(--card-bg-color); height: 100vh; padding: 2rem; display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.05); position: fixed; z-index: 1000; transition: transform 0.3s ease-in-out; }
        .main-content { flex-grow: 1; margin-left: 260px; padding: 2rem 3rem; transition: margin-left 0.3s ease-in-out; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        header h2 { font-size: 2rem; font-weight: 500; margin-bottom: 2rem; }

        /* --- Sidebar --- */
        .sidebar .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 3rem; }
        .sidebar .logo i { font-size: 2rem; color: var(--primary-color); }
        .sidebar .logo h1 { font-size: 1.5rem; font-weight: 600; }
        .sidebar nav ul { list-style: none; }
        .sidebar nav li a { display: flex; align-items: center; gap: 15px; padding: 1rem; text-decoration: none; color: var(--text-light-color); font-weight: 500; border-radius: var(--border-radius); transition: all 0.3s ease; cursor: pointer; }
        .sidebar nav li a:hover, .sidebar nav li a.active { background-color: #f0edff; color: var(--primary-color); }
        .sidebar nav li a i { width: 20px; text-align: center; }

        /* --- Elementos Comuns --- */
        .card { background-color: var(--card-bg-color); padding: 1.5rem 2rem; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
        .iphone-card { background-color: var(--card-bg-color); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--card-shadow); margin-bottom: 1.5rem; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .iphone-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: background-color 0.3s ease; }
        .btn.primary { background-color: var(--primary-color); color: white; }
        .btn.secondary { background-color: #e0e0e0; color: var(--text-color); }
        .btn.success { background-color: var(--success-color); color: white; }
        .btn.danger { background-color: var(--danger-color); color: white; }
        .btn.download { background-color: var(--pending-color); color: white; }
        .btn.edit { background-color: #4B90F7; color: white; }
        .list-item { background-color: var(--card-bg-color); padding: 1rem 1.5rem; margin-bottom: 0.5rem; border-radius: var(--border-radius); display: flex; align-items: center; justify-content: space-between; position: relative; cursor: pointer; transition: background-color 0.2s ease; }
        .list-item:hover { background-color: #f8f9fa; }
        .list-item:hover .delete-btn { opacity: 1; }
        .delete-btn { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 1rem; opacity: 0; transition: opacity 0.3s ease; z-index: 5; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        /* --- Dashboard --- */
        #dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 2rem; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; color: var(--text-light-color); }
        .card-header i { font-size: 1.8rem; }
        #dashboard-cards .balance i { color: var(--secondary-color); }
        #dashboard-cards .income i { color: var(--success-color); }
        #dashboard-cards .expense i { color: var(--danger-color); }
        .card p { font-size: 2rem; font-weight: 500; }
        #account-balances { margin-bottom: 2rem; }
        #account-balances h3 { font-weight: 500; margin-bottom: 1rem; }
        #account-balances-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .account-card { background: #fff; padding: 1rem; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
        .account-card-header { display: flex; align-items: center; gap: 0.5rem; color: var(--text-light-color); font-size: 0.9rem; margin-bottom: 0.5rem; }
        .account-card-balance { font-size: 1.5rem; font-weight: 500; }

        .transaction-details { display: flex; align-items: center; gap: 1rem; }
        .transaction-status { width: 10px; height: 10px; border-radius: 50%; }
        .transaction-status.completed { background-color: var(--success-color); }
        .transaction-status.pending { background-color: var(--pending-color); }
        .transaction-info span { display: block; }
        .transaction-info .description { font-weight: 500; }
        .transaction-info .details { font-size: 0.8rem; color: var(--text-light-color); }
        .transaction-amount { font-weight: 500; font-size: 1.1rem; }
        .transaction-amount.income { color: var(--success-color); }
        .transaction-amount.expense { color: var(--danger-color); }
        .list-item-actions { display: flex; align-items: center; gap: 1rem; }

        /* --- Páginas de Gerenciamento (Categorias, Contas) --- */
        .management-page .card { margin-bottom: 2rem; }
        .management-page form { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; }
        .management-page .form-control { flex-grow: 1; min-width: 200px; }
        .management-page label { font-size: 0.9rem; margin-bottom: 0.25rem; display: block;}
        .management-page input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; }
        .management-page .list-item i { font-size: 1.2rem; margin-right: 1rem; color: var(--primary-color); }
        .list-item-main { flex-grow: 1; display: flex; align-items: center; }

        /* --- Página Pendentes --- */
        .pending-actions { display: flex; gap: 0.5rem; align-items: center; }
        .confirm-btn { padding: 8px 12px; font-size: 0.9rem; }

        /* --- Página Relatórios --- */
        #reports-page .filters { background-color: #fff; padding: 1.5rem; margin-bottom: 2rem; border-radius: var(--border-radius); display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        #reports-page .filters .form-control { flex-grow: 1; min-width: 200px; }
        #reports-page .filters label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        #reports-page .filters input, #reports-page .filters select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        #report-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .report-card p { font-size: 1.5rem; }
        .chart-container { background: #fff; padding: 2rem; border-radius: var(--border-radius); margin-bottom: 2rem; }
        
        /* --- Modal e FAB --- */
        .fab { position: fixed; bottom: 2rem; right: 3rem; width: 60px; height: 60px; background-color: var(--primary-color); color: white; border: none; border-radius: 50%; font-size: 2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(0,0,0,0.2); cursor: pointer; z-index: 101; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 102; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { background-color: var(--card-bg-color); padding: 2rem; border-radius: var(--border-radius); width: 90%; max-width: 500px; position: relative; }
        .modal-content h3 { margin-bottom: 1.5rem; }
        .form-control { margin-bottom: 1rem; }
        .form-control label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-control input, .form-control select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-family: 'Poppins', sans-serif; font-size: 1rem; }
        .modal-actions { display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem; }
        .modal-actions .spacer { flex-grow: 1; }
        .form-switch { display: flex; align-items: center; gap: 10px; }

        /* --- Header Mobile --- */
        .mobile-header { display: none; align-items: center; gap: 1rem; padding: 1rem 1.5rem; background-color: var(--card-bg-color); box-shadow: var(--box-shadow); margin-bottom: 1.5rem; }
        .mobile-header #menu-toggle-btn { background: none; border: none; font-size: 1.5rem; color: var(--text-color); cursor: pointer; }
        .mobile-header h2 { font-size: 1.25rem; margin-bottom: 0; }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999; }
        .sidebar-overlay.active { display: block; }
        
        /* --- Dashboard Cards --- */
        .dashboard-card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .dashboard-card { background-color: var(--card-bg-color); padding: 1.2rem; border-radius: var(--border-radius); box-shadow: var(--card-shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; }
        .dashboard-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); }
        .dashboard-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; }
        .dashboard-card-title { font-size: 0.9rem; font-weight: 500; }
        .dashboard-card-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .dashboard-card-content { font-size: 1.4rem; font-weight: 600; margin-bottom: 0.8rem; }
        .dashboard-card-footer { font-size: 0.8rem; color: var(--text-light-color); }
        
        /* --- Cores dos Cards --- */
        .card-1 { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; }
        .card-2 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: white; }
        .card-3 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: var(--text-color); }
        .card-4 { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); color: var(--text-color); }
        .card-5 { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); color: white; }
        .card-6 { background: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%); color: white; }
        
        /* --- Backup Section --- */
        .backup-section { background-color: #fff; padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 2rem; }
        .backup-actions { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem; }
        
        /* --- Metas Section --- */
        .goal-card { background-color: var(--card-bg-color); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--card-shadow); margin-bottom: 1.5rem; }
        .goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .goal-progress { margin-top: 1rem; }
        .progress-bar { height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; margin-top: 0.5rem; }
        .progress-fill { height: 100%; background-color: var(--success-color); transition: width 0.3s ease; }
        .goal-actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .goal-stats { display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light-color); }
        
        /* --- Responsividade --- */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 0; }
            .page-content { padding: 0 1.5rem 1.5rem 1.5rem; }
            header { display: none; }
            .mobile-header { display: flex; }
            .form-grid { grid-template-columns: 1fr; }
            .fab { right: 1.5rem; bottom: 1.5rem; }
            .list-item { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .list-item-actions { width: 100%; justify-content: flex-end; }
            .dashboard-card-grid { grid-template-columns: repeat(2, 1fr); }
            .backup-actions { flex-direction: column; }
        }
        
        @media (max-width: 480px) {
            .dashboard-card-grid { grid-template-columns: 1fr; }
        }

    </style>
</head>
<body>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <aside class="sidebar" id="sidebar">
        <div class="logo"><i class="fa-solid fa-wallet"></i><h1>Controle Pro</h1></div>
        <nav>
            <ul id="nav-links">
                <li><a data-page="dashboard-page" class="active"><i class="fa-solid fa-chart-pie"></i> Dashboard</a></li>
                <li><a data-page="pending-page"><i class="fa-solid fa-hourglass-half"></i> Pendentes</a></li>
                <li><a data-page="categories-page"><i class="fa-solid fa-tags"></i> Categorias</a></li>
                <li><a data-page="accounts-page"><i class="fa-solid fa-credit-card"></i> Contas</a></li>
                <li><a data-page="goals-page"><i class="fa-solid fa-bullseye"></i> Metas</a></li>
                <li><a data-page="reports-page"><i class="fa-solid fa-chart-line"></i> Relatórios</a></li>
                <li><a data-page="backup-page"><i class="fa-solid fa-download"></i> Backup</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <header class="mobile-header">
            <button id="menu-toggle-btn"><i class="fa-solid fa-bars"></i></button>
            <h2 id="mobile-page-title">Dashboard</h2>
        </header>

        <section id="dashboard-page" class="page-content active">
            <header><h2>Dashboard</h2></header>
            
            <div class="dashboard-card-grid">
                <div class="dashboard-card card-1" data-target="dashboard-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Saldo Geral</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-dollar-sign"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="balance-display">R$ 0,00</div>
                    <div class="dashboard-card-footer">Atualizado em tempo real</div>
                </div>
                
                <div class="dashboard-card card-2" data-target="reports-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Receitas do Mês</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-arrow-up"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="income-display">R$ 0,00</div>
                    <div class="dashboard-card-footer">Baseado nas transações efetivadas</div>
                </div>
                
                <div class="dashboard-card card-3" data-target="reports-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Despesas do Mês</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-arrow-down"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="expense-display">R$ 0,00</div>
                    <div class="dashboard-card-footer">Baseado nas transações efetivadas</div>
                </div>
                
                <div class="dashboard-card card-4" data-target="pending-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Transações Pendentes</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-hourglass-half"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="pending-total-display">R$ 0,00</div>
                    <div class="dashboard-card-footer">Total de transações não confirmadas</div>
                </div>
                
                <div class="dashboard-card card-5" data-target="goals-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Metas Ativas</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-bullseye"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="goals-count-display">0</div>
                    <div class="dashboard-card-footer">Metas financeiras em andamento</div>
                </div>
                
                <div class="dashboard-card card-6" data-target="goals-page">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-title">Economias</div>
                        <div class="dashboard-card-icon"><i class="fa-solid fa-piggy-bank"></i></div>
                    </div>
                    <div class="dashboard-card-content" id="savings-display">R$ 0,00</div>
                    <div class="dashboard-card-footer">Total economizado em metas</div>
                </div>
            </div>
            
            <div id="account-balances">
                <h3>Saldo das Contas</h3>
                <div id="account-balances-list"></div>
            </div>
            
            <div class="iphone-card">
                <h3>Metas em Andamento</h3>
                <ul id="goals-dashboard-list"></ul>
            </div>
            
            <div class="iphone-card">
                <h3>Transações Pendentes</h3>
                <ul id="pending-dashboard-list"></ul>
            </div>
            
            <div class="iphone-card">
                <h3>Próximos Vencimentos</h3>
                <ul id="upcoming-list"></ul>
            </div>
            
            <div id="history">
                <h3>Últimas Transações</h3>
                <ul id="transaction-list"></ul>
            </div>
        </section>
        
        <section id="pending-page" class="page-content">
            <header><h2>Transações Pendentes</h2></header>
            
            <div class="iphone-card">
                <div class="card-header">
                    <span>Resumo das Pendências</span>
                    <span id="pending-summary">Total: R$ 0,00</span>
                </div>
                <ul id="pending-list"></ul>
            </div>
        </section>

        <section id="categories-page" class="page-content management-page">
            <header><h2>Gerenciar Categorias</h2></header>
            <div class="iphone-card">
                <form id="category-form"><div class="form-control"><label for="category-name">Nome da Categoria</label><input type="text" id="category-name" required></div><button type="submit" class="btn primary">Adicionar</button></form>
            </div>
            <ul id="category-list"></ul>
        </section>
        
        <section id="accounts-page" class="page-content management-page">
            <header><h2>Gerenciar Contas</h2></header>
            <div class="iphone-card">
                <form id="account-form">
                    <div class="form-control"><label for="account-name">Nome da Conta</label><input type="text" id="account-name" required></div>
                    <div class="form-control"><label for="account-initial-balance">Saldo Inicial</label><input type="number" id="account-initial-balance" step="0.01" value="0" required></div>
                    <button type="submit" class="btn primary">Adicionar</button>
                </form>
            </div>
            <ul id="account-list"></ul>
        </section>
        
        <section id="goals-page" class="page-content">
            <header><h2>Metas Financeiras</h2></header>
            
            <div class="iphone-card">
                <h3>Criar Nova Meta</h3>
                <form id="goal-form">
                    <div class="form-grid">
                        <div class="form-control"><label for="goal-name">Nome da Meta</label><input type="text" id="goal-name" required></div>
                        <div class="form-control"><label for="goal-target">Valor da Meta (R$)</label><input type="number" id="goal-target" step="0.01" min="0.01" required></div>
                    </div>
                    <div class="form-grid">
                        <div class="form-control"><label for="goal-deadline">Prazo</label><input type="date" id="goal-deadline" required></div>
                        <div class="form-control"><label for="goal-initial-amount">Valor Inicial (R$)</label><input type="number" id="goal-initial-amount" step="0.01" min="0" value="0"></div>
                    </div>
                    <div class="form-control"><label for="goal-description">Descrição (opcional)</label><textarea id="goal-description" rows="2"></textarea></div>
                    <button type="submit" class="btn primary">Criar Meta</button>
                </form>
            </div>
            
            <div id="goals-list"></div>
        </section>

        <section id="reports-page" class="page-content">
            <header><h2>Relatórios</h2></header>
            
            <div class="iphone-card">
                <div class="filters">
                    <div class="form-control"><label for="start-date">Data Início</label><input type="date" id="start-date"></div>
                    <div class="form-control"><label for="end-date">Data Fim</label><input type="date" id="end-date"></div>
                    <div class="form-control"><label for="category-filter">Filtrar por Categoria</label>
                        <select id="category-filter">
                            <option value="">Todas as categorias</option>
                        </select>
                    </div>
                    <button class="btn download" id="download-report-btn"><i class="fa-solid fa-download"></i> Baixar Relatório PDF</button>
                </div>
            </div>
            
            <div id="report-summary"></div>
            <div class="chart-container"><h3>Despesas por Categoria</h3><canvas id="expense-chart"></canvas></div>
            <div class="chart-container"><h3>Receitas vs. Despesas</h3><canvas id="flow-chart"></canvas></div>
        </section>
        
        <section id="backup-page" class="page-content">
            <header><h2>Backup e Restauração</h2></header>
            
            <div class="iphone-card">
                <h3>Backup dos Dados</h3>
                <p>Faça backup de todos os seus dados financeiros para garantir que não serão perdidos.</p>
                <div class="backup-actions">
                    <button class="btn primary" id="backup-btn"><i class="fa-solid fa-download"></i> Fazer Backup</button>
                    <button class="btn download" id="download-all-btn"><i class="fa-solid fa-file-download"></i> Baixar Todos os Dados</button>
                </div>
            </div>
            
            <div class="iphone-card">
                <h3>Restaurar Dados</h3>
                <p>Restaurar dados de um backup anterior.</p>
                <div class="backup-actions">
                    <input type="file" id="restore-file" accept=".json" style="display: none;">
                    <button class="btn secondary" id="choose-file-btn"><i class="fa-solid fa-file-upload"></i> Escolher Arquivo</button>
                    <button class="btn success" id="restore-btn" disabled><i class="fa-solid fa-upload"></i> Restaurar Dados</button>
                </div>
                <p id="restore-status" style="margin-top: 1rem; font-size: 0.9rem;"></p>
            </div>
        </section>
    </main>

    <button class="fab" id="fab-add-btn" title="Adicionar Transação"><i class="fa-solid fa-plus"></i></button>
    
    <div class="modal-overlay" id="add-modal-overlay">
        <div class="modal-content">
            <h3>Nova Transação</h3>
            <form id="transaction-form">
                <div class="form-control"><label for="description">Descrição</label><input type="text" id="description" required></div>
                <div class="form-grid">
                    <div class="form-control"><label for="amount">Valor</label><input type="number" id="amount" placeholder="Ex: -50,00 ou 1500,00" step="0.01" required></div>
                    <div class="form-control"><label for="date">Data</label><input type="date" id="date" required></div>
                </div>
                <div class="form-grid">
                    <div class="form-control"><label for="category">Categoria</label><select id="category" required></select></div>
                    <div class="form-control"><label for="account">Conta</label><select id="account" required></select></div>
                </div>
                <div class="form-control form-switch"><input type="checkbox" id="is-pending" style="width: auto;"><label for="is-pending">Marcar como pendente</label></div>
                <div class="modal-actions"><button type="button" class="btn secondary" id="cancel-add-btn">Cancelar</button><button type="submit" class="btn primary">Salvar</button></div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="view-edit-modal-overlay">
        <div class="modal-content">
            <h3>Detalhes da Transação</h3>
            <form id="edit-transaction-form">
                <input type="hidden" id="edit-transaction-id">
                <div class="form-control"><label for="edit-description">Descrição</label><input type="text" id="edit-description" required></div>
                <div class="form-grid">
                    <div class="form-control"><label for="edit-amount">Valor</label><input type="number" id="edit-amount" placeholder="Ex: -50,00 ou 1500,00" step="0.01" required></div>
                    <div class="form-control"><label for="edit-date">Data</label><input type="date" id="edit-date" required></div>
                </div>
                <div class="form-grid">
                    <div class="form-control"><label for="edit-category">Categoria</label><select id="edit-category" required></select></div>
                    <div class="form-control"><label for="edit-account">Conta</label><select id="edit-account" required></select></div>
                </div>
                <div class="form-control form-switch"><input type="checkbox" id="edit-is-pending" style="width: auto;"><label for="edit-is-pending">Transação pendente</label></div>
                <div class="modal-actions">
                    <button type="button" class="btn danger" id="delete-from-modal-btn">Excluir</button>
                    <div class="spacer"></div>
                    <button type="button" class="btn download" id="download-receipt-btn"><i class="fa-solid fa-download"></i> Baixar Recibo PDF</button>
                    <button type="button" class="btn edit" id="edit-transaction-btn"><i class="fa-solid fa-edit"></i> Editar</button>
                    <button type="button" class="btn secondary" id="cancel-edit-btn">Cancelar</button>
                    <button type="submit" class="btn primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal-overlay" id="goal-transfer-modal-overlay">
        <div class="modal-content">
            <h3>Transferir para Meta</h3>
            <form id="goal-transfer-form">
                <input type="hidden" id="transfer-goal-id">
                <div class="form-control"><label for="transfer-amount">Valor para Transferir (R$)</label><input type="number" id="transfer-amount" step="0.01" min="0.01" required></div>
                <div class="form-control"><label for="transfer-from">Transferir de</label><select id="transfer-from" required></select></div>
                <div class="modal-actions">
                    <button type="button" class="btn secondary" id="cancel-transfer-btn">Cancelar</button>
                    <button type="submit" class="btn primary">Transferir</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========== INICIALIZAÇÃO E VARIÁVEIS GLOBAIS ==========
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            { id: 1, name: 'Alimentação' },
            { id: 2, name: 'Transporte' },
            { id: 3, name: 'Moradia' },
            { id: 4, name: 'Saúde' },
            { id: 5, name: 'Educação' },
            { id: 6, name: 'Lazer' },
            { id: 7, name: 'Salário' },
            { id: 8, name: 'Investimentos' },
            { id: 9, name: 'Outros' }
        ];
        let accounts = JSON.parse(localStorage.getItem('accounts')) || [
            { id: 1, name: 'Carteira', balance: 0 },
            { id: 2, name: 'Conta Corrente', balance: 0 },
            { id: 3, name: 'Poupança', balance: 0 }
        ];
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let nextTransactionId = parseInt(localStorage.getItem('nextTransactionId')) || 1;
        let nextCategoryId = parseInt(localStorage.getItem('nextCategoryId')) || 10;
        let nextAccountId = parseInt(localStorage.getItem('nextAccountId')) || 4;
        let nextGoalId = parseInt(localStorage.getItem('nextGoalId')) || 1;
        
        // ========== FUNÇÕES DE INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateUI();
        });
        
        function initializeApp() {
            // Inicializar dados de exemplo se não houver dados salvos
            if (transactions.length === 0) {
                const today = new Date();
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 15);
                
                transactions = [
                    { id: nextTransactionId++, description: 'Salário', amount: 3500, date: formatDate(lastMonth), categoryId: 7, accountId: 2, isPending: false },
                    { id: nextTransactionId++, description: 'Aluguel', amount: -1200, date: formatDate(lastMonth), categoryId: 3, accountId: 2, isPending: false },
                    { id: nextTransactionId++, description: 'Mercado', amount: -450, date: formatDate(lastMonth), categoryId: 1, accountId: 1, isPending: false },
                    { id: nextTransactionId++, description: 'Gasolina', amount: -180, date: formatDate(lastMonth), categoryId: 2, accountId: 1, isPending: false },
                    { id: nextTransactionId++, description: 'Academia', amount: -80, date: formatDate(today), categoryId: 4, accountId: 2, isPending: false },
                    { id: nextTransactionId++, description: 'Restaurante', amount: -120, date: formatDate(today), categoryId: 1, accountId: 1, isPending: true },
                    { id: nextTransactionId++, description: 'Freelance', amount: 800, date: formatDate(today), categoryId: 7, accountId: 2, isPending: true }
                ];
                
                saveData();
            }
            
            // Inicializar metas de exemplo
            if (goals.length === 0) {
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 3);
                
                goals = [
                    { id: nextGoalId++, name: 'Viagem de Férias', target: 5000, currentAmount: 1500, deadline: formatDate(nextMonth), description: 'Economizar para viagem de férias em Dezembro' },
                    { id: nextGoalId++, name: 'Notebook Novo', target: 2500, currentAmount: 800, deadline: formatDate(new Date(nextMonth.getFullYear(), nextMonth.getMonth() + 2, 15)), description: 'Comprar um notebook para trabalho' }
                ];
                
                saveData();
            }
            
            // Inicializar elementos da interface
            populateCategories();
            populateAccounts();
            updateDashboardCards();
            updateTransactionList();
            updatePendingList();
            updateAccountBalances();
            updateGoalsList();
        }
        
        function setupEventListeners() {
            // Navegação
            document.querySelectorAll('#nav-links a').forEach(link => {
                link.addEventListener('click', function() {
                    document.querySelectorAll('#nav-links a').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Atualizar título no mobile
                    document.getElementById('mobile-page-title').textContent = this.textContent.trim();
                });
            });
            
            // Dashboard cards como links de navegação
            document.querySelectorAll('.dashboard-card').forEach(card => {
                card.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-target');
                    if (targetPage) {
                        document.querySelectorAll('#nav-links a').forEach(l => l.classList.remove('active'));
                        document.querySelector(`a[data-page="${targetPage}"]`).classList.add('active');
                        showPage(targetPage);
                        document.getElementById('mobile-page-title').textContent = document.querySelector(`a[data-page="${targetPage}"]`).textContent.trim();
                    }
                });
            });
            
            // Menu mobile
            document.getElementById('menu-toggle-btn').addEventListener('click', toggleSidebar);
            document.getElementById('sidebar-overlay').addEventListener('click', toggleSidebar);
            
            // Modal de adicionar transação
            document.getElementById('fab-add-btn').addEventListener('click', showAddModal);
            document.getElementById('cancel-add-btn').addEventListener('click', hideAddModal);
            document.getElementById('transaction-form').addEventListener('submit', addTransaction);
            
            // Modal de editar transação
            document.getElementById('cancel-edit-btn').addEventListener('click', hideEditModal);
            document.getElementById('edit-transaction-btn').addEventListener('click', enableEditMode);
            document.getElementById('edit-transaction-form').addEventListener('submit', saveEditedTransaction);
            document.getElementById('delete-from-modal-btn').addEventListener('click', deleteTransactionFromModal);
            document.getElementById('download-receipt-btn').addEventListener('click', downloadReceipt);
            
            // Modal de transferência para metas
            document.getElementById('cancel-transfer-btn').addEventListener('click', hideTransferModal);
            document.getElementById('goal-transfer-form').addEventListener('submit', processGoalTransfer);
            
            // Categorias
            document.getElementById('category-form').addEventListener('submit', addCategory);
            
            // Contas
            document.getElementById('account-form').addEventListener('submit', addAccount);
            
            // Metas
            document.getElementById('goal-form').addEventListener('submit', addGoal);
            
            // Relatórios
            document.getElementById('start-date').addEventListener('change', updateReports);
            document.getElementById('end-date').addEventListener('change', updateReports);
            document.getElementById('category-filter').addEventListener('change', updateReports);
            document.getElementById('download-report-btn').addEventListener('click', downloadReportPDF);
            
            // Backup
            document.getElementById('backup-btn').addEventListener('click', createBackup);
            document.getElementById('download-all-btn').addEventListener('click', downloadAllData);
            document.getElementById('choose-file-btn').addEventListener('click', () => document.getElementById('restore-file').click());
            document.getElementById('restore-file').addEventListener('change', enableRestoreButton);
            document.getElementById('restore-btn').addEventListener('click', restoreData);
            
            // Inicializar datas nos filtros
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('start-date').value = formatDate(firstDay);
            document.getElementById('end-date').value = formatDate(today);
            
            // Inicializar relatórios
            updateReports();
        }
        
        // ========== FUNÇÕES DE NAVEGAÇÃO E UI ==========
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Atualizar elementos específicos da página
            if (pageId === 'reports-page') {
                updateReports();
            } else if (pageId === 'goals-page') {
                updateGoalsList();
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        function showAddModal() {
            document.getElementById('add-modal-overlay').classList.add('active');
            document.getElementById('description').focus();
        }
        
        function hideAddModal() {
            document.getElementById('add-modal-overlay').classList.remove('active');
            document.getElementById('transaction-form').reset();
        }
        
        function showEditModal(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            document.getElementById('edit-transaction-id').value = transaction.id;
            document.getElementById('edit-description').value = transaction.description;
            document.getElementById('edit-amount').value = transaction.amount;
            document.getElementById('edit-date').value = transaction.date;
            document.getElementById('edit-is-pending').checked = transaction.isPending;
            
            // Preencher selects
            populateCategories('edit-category');
            populateAccounts('edit-account');
            
            // Definir valores selecionados
            document.getElementById('edit-category').value = transaction.categoryId;
            document.getElementById('edit-account').value = transaction.accountId;
            
            // Desabilitar edição inicialmente
            disableEditMode();
            
            document.getElementById('view-edit-modal-overlay').classList.add('active');
        }
        
        function hideEditModal() {
            document.getElementById('view-edit-modal-overlay').classList.remove('active');
            document.getElementById('edit-transaction-form').reset();
        }
        
        function enableEditMode() {
            document.getElementById('edit-description').disabled = false;
            document.getElementById('edit-amount').disabled = false;
            document.getElementById('edit-date').disabled = false;
            document.getElementById('edit-category').disabled = false;
            document.getElementById('edit-account').disabled = false;
            document.getElementById('edit-is-pending').disabled = false;
            
            document.getElementById('edit-transaction-btn').style.display = 'none';
            document.getElementById('cancel-edit-btn').style.display = 'inline-block';
            document.querySelector('#edit-transaction-form button[type="submit"]').style.display = 'inline-block';
        }
        
        function disableEditMode() {
            document.getElementById('edit-description').disabled = true;
            document.getElementById('edit-amount').disabled = true;
            document.getElementById('edit-date').disabled = true;
            document.getElementById('edit-category').disabled = true;
            document.getElementById('edit-account').disabled = true;
            document.getElementById('edit-is-pending').disabled = true;
            
            document.getElementById('edit-transaction-btn').style.display = 'inline-block';
            document.getElementById('cancel-edit-btn').style.display = 'none';
            document.querySelector('#edit-transaction-form button[type="submit"]').style.display = 'none';
        }
        
        function showTransferModal(goalId) {
            document.getElementById('transfer-goal-id').value = goalId;
            populateAccounts('transfer-from');
            document.getElementById('goal-transfer-modal-overlay').classList.add('active');
        }
        
        function hideTransferModal() {
            document.getElementById('goal-transfer-modal-overlay').classList.remove('active');
            document.getElementById('goal-transfer-form').reset();
        }
        
        // ========== FUNÇÕES DE ATUALIZAÇÃO DA INTERFACE ==========
        function updateUI() {
            updateTransactionList();
            updatePendingList();
            updateAccountBalances();
            updateDashboardCards();
            updateGoalsList();
        }
        
        function updateDashboardCards() {
            // Calcular totais
            const totalBalance = accounts.reduce((sum, account) => sum + account.balance, 0);
            const totalIncome = transactions
                .filter(t => !t.isPending && t.amount > 0)
                .reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions
                .filter(t => !t.isPending && t.amount < 0)
                .reduce((sum, t) => sum + t.amount, 0);
            const totalPending = transactions
                .filter(t => t.isPending)
                .reduce((sum, t) => sum + t.amount, 0);
            const totalSavings = goals.reduce((sum, goal) => sum + goal.currentAmount, 0);
            
            // Atualizar cards do dashboard
            document.getElementById('balance-display').textContent = formatCurrency(totalBalance);
            document.getElementById('income-display').textContent = formatCurrency(totalIncome);
            document.getElementById('expense-display').textContent = formatCurrency(Math.abs(totalExpense));
            document.getElementById('pending-total-display').textContent = formatCurrency(Math.abs(totalPending));
            document.getElementById('goals-count-display').textContent = goals.length;
            document.getElementById('savings-display').textContent = formatCurrency(totalSavings);
            
            // Atualizar lista de metas no dashboard
            const goalsDashboardList = document.getElementById('goals-dashboard-list');
            goalsDashboardList.innerHTML = '';
            
            const activeGoals = goals
                .filter(goal => goal.currentAmount < goal.target)
                .slice(0, 3);
            
            if (activeGoals.length === 0) {
                goalsDashboardList.innerHTML = '<li class="list-item"><span>Nenhuma meta em andamento</span></li>';
            } else {
                activeGoals.forEach(goal => {
                    const progress = (goal.currentAmount / goal.target) * 100;
                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                    
                    const li = document.createElement('li');
                    li.className = 'list-item';
                    li.innerHTML = `
                        <div class="list-item-main">
                            <span>${goal.name}</span>
                            <small>${formatCurrency(goal.currentAmount)} / ${formatCurrency(goal.target)} (${progress.toFixed(1)}%)</small>
                        </div>
                        <div class="list-item-actions">
                            <span>${daysLeft > 0 ? `${daysLeft} dias` : 'Vencida'}</span>
                        </div>
                    `;
                    goalsDashboardList.appendChild(li);
                });
            }
            
            // Atualizar lista de pendentes no dashboard
            const pendingDashboardList = document.getElementById('pending-dashboard-list');
            pendingDashboardList.innerHTML = '';
            
            const pendingTransactions = transactions
                .filter(t => t.isPending)
                .slice(0, 3);
            
            if (pendingTransactions.length === 0) {
                pendingDashboardList.innerHTML = '<li class="list-item"><span>Nenhuma transação pendente</span></li>';
            } else {
                pendingTransactions.forEach(transaction => {
                    const category = categories.find(c => c.id === transaction.categoryId);
                    const account = accounts.find(a => a.id === transaction.accountId);
                    
                    const li = document.createElement('li');
                    li.className = 'list-item';
                    li.innerHTML = `
                        <div class="transaction-details">
                            <div class="transaction-status pending"></div>
                            <div class="transaction-info">
                                <span class="description">${transaction.description}</span>
                                <span class="details">${category ? category.name : 'Sem categoria'} • ${account ? account.name : 'Sem conta'}</span>
                            </div>
                        </div>
                        <div class="transaction-amount ${transaction.amount > 0 ? 'income' : 'expense'}">
                            ${formatCurrency(transaction.amount)}
                        </div>
                    `;
                    pendingDashboardList.appendChild(li);
                });
            }
            
            // Atualizar próximos vencimentos
            const upcomingList = document.getElementById('upcoming-list');
            upcomingList.innerHTML = '';
            
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const upcomingTransactions = transactions
                .filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate >= today && transactionDate <= nextWeek && t.amount < 0;
                })
                .slice(0, 3);
            
            if (upcomingTransactions.length === 0) {
                upcomingList.innerHTML = '<li class="list-item"><span>Nenhum vencimento próximo</span></li>';
            } else {
                upcomingTransactions.forEach(transaction => {
                    const category = categories.find(c => c.id === transaction.categoryId);
                    
                    const li = document.createElement('li');
                    li.className = 'list-item';
                    li.innerHTML = `
                        <div class="list-item-main">
                            <span>${transaction.description}</span>
                            <small>${category ? category.name : 'Sem categoria'} • ${formatDateDisplay(transaction.date)}</small>
                        </div>
                        <div class="transaction-amount expense">
                            ${formatCurrency(transaction.amount)}
                        </div>
                    `;
                    upcomingList.appendChild(li);
                });
            }
        }
        
        function updateTransactionList() {
            const transactionList = document.getElementById('transaction-list');
            transactionList.innerHTML = '';
            
            // Ordenar transações por data (mais recente primeiro)
            const sortedTransactions = [...transactions]
                .filter(t => !t.isPending)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            if (sortedTransactions.length === 0) {
                transactionList.innerHTML = '<li class="list-item"><span>Nenhuma transação registrada</span></li>';
                return;
            }
            
            sortedTransactions.forEach(transaction => {
                const category = categories.find(c => c.id === transaction.categoryId);
                const account = accounts.find(a => a.id === transaction.accountId);
                
                const li = document.createElement('li');
                li.className = 'list-item';
                li.addEventListener('click', () => showEditModal(transaction.id));
                
                li.innerHTML = `
                    <div class="transaction-details">
                        <div class="transaction-status completed"></div>
                        <div class="transaction-info">
                            <span class="description">${transaction.description}</span>
                            <span class="details">${category ? category.name : 'Sem categoria'} • ${account ? account.name : 'Sem conta'} • ${formatDateDisplay(transaction.date)}</span>
                        </div>
                    </div>
                    <div class="transaction-amount ${transaction.amount > 0 ? 'income' : 'expense'}">
                        ${formatCurrency(transaction.amount)}
                    </div>
                `;
                
                transactionList.appendChild(li);
            });
        }
        
        function updatePendingList() {
            const pendingList = document.getElementById('pending-list');
            pendingList.innerHTML = '';
            
            const pendingTransactions = transactions.filter(t => t.isPending);
            
            // Atualizar resumo
            const pendingTotal = pendingTransactions.reduce((sum, t) => sum + t.amount, 0);
            document.getElementById('pending-summary').textContent = `Total: ${formatCurrency(pendingTotal)}`;
            
            if (pendingTransactions.length === 0) {
                pendingList.innerHTML = '<li class="list-item"><span>Nenhuma transação pendente</span></li>';
                return;
            }
            
            pendingTransactions.forEach(transaction => {
                const category = categories.find(c => c.id === transaction.categoryId);
                const account = accounts.find(a => a.id === transaction.accountId);
                
                const li = document.createElement('li');
                li.className = 'list-item';
                
                li.innerHTML = `
                    <div class="transaction-details">
                        <div class="transaction-status pending"></div>
                        <div class="transaction-info">
                            <span class="description">${transaction.description}</span>
                            <span class="details">${category ? category.name : 'Sem categoria'} • ${account ? account.name : 'Sem conta'} • ${formatDateDisplay(transaction.date)}</span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <div class="transaction-amount ${transaction.amount > 0 ? 'income' : 'expense'}">
                            ${formatCurrency(transaction.amount)}
                        </div>
                        <div class="pending-actions">
                            <button class="btn success confirm-btn" data-id="${transaction.id}">Confirmar</button>
                            <button class="btn danger confirm-btn" data-id="${transaction.id}">Cancelar</button>
                        </div>
                    </div>
                `;
                
                pendingList.appendChild(li);
            });
            
            // Adicionar event listeners aos botões
            document.querySelectorAll('.confirm-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const transactionId = parseInt(this.getAttribute('data-id'));
                    const isConfirm = this.classList.contains('success');
                    
                    if (isConfirm) {
                        confirmPendingTransaction(transactionId);
                    } else {
                        deleteTransaction(transactionId);
                    }
                });
            });
        }
        
        function updateAccountBalances() {
            const accountBalancesList = document.getElementById('account-balances-list');
            accountBalancesList.innerHTML = '';
            
            accounts.forEach(account => {
                const accountCard = document.createElement('div');
                accountCard.className = 'account-card';
                
                accountCard.innerHTML = `
                    <div class="account-card-header">
                        <i class="fa-solid fa-wallet"></i>
                        <span>${account.name}</span>
                    </div>
                    <div class="account-card-balance">${formatCurrency(account.balance)}</div>
                `;
                
                accountBalancesList.appendChild(accountCard);
            });
        }
        
        function updateGoalsList() {
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';
            
            if (goals.length === 0) {
                goalsList.innerHTML = '<div class="goal-card"><p>Nenhuma meta financeira criada ainda.</p></div>';
                return;
            }
            
            goals.forEach(goal => {
                const progress = (goal.currentAmount / goal.target) * 100;
                const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                const isCompleted = goal.currentAmount >= goal.target;
                
                const goalCard = document.createElement('div');
                goalCard.className = 'goal-card';
                
                goalCard.innerHTML = `
                    <div class="goal-header">
                        <h3>${goal.name}</h3>
                        <span class="${isCompleted ? 'success' : daysLeft < 0 ? 'danger' : ''}">
                            ${isCompleted ? 'Concluída' : daysLeft < 0 ? 'Vencida' : `${daysLeft} dias restantes`}
                        </span>
                    </div>
                    <p>${goal.description || 'Sem descrição'}</p>
                    <div class="goal-progress">
                        <div class="goal-stats">
                            <span>${formatCurrency(goal.currentAmount)}</span>
                            <span>${formatCurrency(goal.target)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="goal-stats">
                            <span>${progress.toFixed(1)}%</span>
                            <span>${isCompleted ? 'Meta atingida!' : `Faltam ${formatCurrency(goal.target - goal.currentAmount)}`}</span>
                        </div>
                    </div>
                    <div class="goal-actions">
                        <button class="btn primary transfer-to-goal-btn" data-id="${goal.id}">Adicionar Valor</button>
                        <button class="btn danger delete-goal-btn" data-id="${goal.id}">Excluir Meta</button>
                    </div>
                `;
                
                goalsList.appendChild(goalCard);
            });
            
            // Adicionar event listeners aos botões
            document.querySelectorAll('.transfer-to-goal-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const goalId = parseInt(this.getAttribute('data-id'));
                    showTransferModal(goalId);
                });
            });
            
            document.querySelectorAll('.delete-goal-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const goalId = parseInt(this.getAttribute('data-id'));
                    deleteGoal(goalId);
                });
            });
        }
        
        // ========== FUNÇÕES DE GERENCIAMENTO DE DADOS ==========
        function addTransaction(e) {
            e.preventDefault();
            
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;
            const categoryId = parseInt(document.getElementById('category').value);
            const accountId = parseInt(document.getElementById('account').value);
            const isPending = document.getElementById('is-pending').checked;
            
            const transaction = {
                id: nextTransactionId++,
                description,
                amount,
                date,
                categoryId,
                accountId,
                isPending
            };
            
            transactions.push(transaction);
            
            // Atualizar saldo da conta se não for pendente
            if (!isPending) {
                updateAccountBalance(accountId, amount);
            }
            
            saveData();
            updateUI();
            hideAddModal();
            
            showNotification('Transação adicionada com sucesso!', 'success');
        }
        
        function saveEditedTransaction(e) {
            e.preventDefault();
            
            const transactionId = parseInt(document.getElementById('edit-transaction-id').value);
            const transactionIndex = transactions.findIndex(t => t.id === transactionId);
            
            if (transactionIndex === -1) return;
            
            const oldTransaction = transactions[transactionIndex];
            const oldAmount = oldTransaction.amount;
            const oldAccountId = oldTransaction.accountId;
            const oldIsPending = oldTransaction.isPending;
            
            const updatedTransaction = {
                ...oldTransaction,
                description: document.getElementById('edit-description').value,
                amount: parseFloat(document.getElementById('edit-amount').value),
                date: document.getElementById('edit-date').value,
                categoryId: parseInt(document.getElementById('edit-category').value),
                accountId: parseInt(document.getElementById('edit-account').value),
                isPending: document.getElementById('edit-is-pending').checked
            };
            
            // Atualizar saldos das contas
            if (!oldIsPending) {
                // Reverter o valor antigo da conta antiga
                updateAccountBalance(oldAccountId, -oldAmount);
            }
            
            if (!updatedTransaction.isPending) {
                // Aplicar o novo valor na nova conta
                updateAccountBalance(updatedTransaction.accountId, updatedTransaction.amount);
            }
            
            transactions[transactionIndex] = updatedTransaction;
            
            saveData();
            updateUI();
            hideEditModal();
            
            showNotification('Transação atualizada com sucesso!', 'success');
        }
        
        function deleteTransactionFromModal() {
            const transactionId = parseInt(document.getElementById('edit-transaction-id').value);
            deleteTransaction(transactionId);
            hideEditModal();
        }
        
        function deleteTransaction(transactionId) {
            const transactionIndex = transactions.findIndex(t => t.id === transactionId);
            
            if (transactionIndex === -1) return;
            
            const transaction = transactions[transactionIndex];
            
            // Reverter o saldo da conta se a transação não estava pendente
            if (!transaction.isPending) {
                updateAccountBalance(transaction.accountId, -transaction.amount);
            }
            
            transactions.splice(transactionIndex, 1);
            
            saveData();
            updateUI();
            
            showNotification('Transação excluída com sucesso!', 'success');
        }
        
        function confirmPendingTransaction(transactionId) {
            const transactionIndex = transactions.findIndex(t => t.id === transactionId);
            
            if (transactionIndex === -1) return;
            
            transactions[transactionIndex].isPending = false;
            
            // Atualizar saldo da conta
            const transaction = transactions[transactionIndex];
            updateAccountBalance(transaction.accountId, transaction.amount);
            
            saveData();
            updateUI();
            
            showNotification('Transação confirmada com sucesso!', 'success');
        }
        
        function addCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('category-name').value;
            
            if (!name.trim()) return;
            
            const category = {
                id: nextCategoryId++,
                name: name.trim()
            };
            
            categories.push(category);
            
            saveData();
            populateCategories();
            document.getElementById('category-form').reset();
            
            const categoryList = document.getElementById('category-list');
            const li = document.createElement('li');
            li.className = 'list-item';
            li.innerHTML = `
                <div class="list-item-main">
                    <i class="fa-solid fa-tag"></i>
                    <span>${category.name}</span>
                </div>
                <button class="delete-btn" data-id="${category.id}"><i class="fa-solid fa-trash"></i></button>
            `;
            categoryList.appendChild(li);
            
            // Adicionar event listener ao botão de excluir
            li.querySelector('.delete-btn').addEventListener('click', function() {
                const categoryId = parseInt(this.getAttribute('data-id'));
                deleteCategory(categoryId);
            });
            
            showNotification('Categoria adicionada com sucesso!', 'success');
        }
        
        function deleteCategory(categoryId) {
            // Verificar se a categoria está sendo usada em transações
            const isUsed = transactions.some(t => t.categoryId === categoryId);
            
            if (isUsed) {
                showNotification('Não é possível excluir uma categoria que está sendo usada em transações.', 'error');
                return;
            }
            
            const categoryIndex = categories.findIndex(c => c.id === categoryId);
            
            if (categoryIndex === -1) return;
            
            categories.splice(categoryIndex, 1);
            
            saveData();
            populateCategories();
            
            // Remover da lista
            document.querySelectorAll('#category-list .list-item').forEach(item => {
                if (parseInt(item.querySelector('.delete-btn').getAttribute('data-id')) === categoryId) {
                    item.remove();
                }
            });
            
            showNotification('Categoria excluída com sucesso!', 'success');
        }
        
        function addAccount(e) {
            e.preventDefault();
            
            const name = document.getElementById('account-name').value;
            const initialBalance = parseFloat(document.getElementById('account-initial-balance').value) || 0;
            
            if (!name.trim()) return;
            
            const account = {
                id: nextAccountId++,
                name: name.trim(),
                balance: initialBalance
            };
            
            accounts.push(account);
            
            saveData();
            populateAccounts();
            document.getElementById('account-form').reset();
            
            const accountList = document.getElementById('account-list');
            const li = document.createElement('li');
            li.className = 'list-item';
            li.innerHTML = `
                <div class="list-item-main">
                    <i class="fa-solid fa-credit-card"></i>
                    <span>${account.name} - ${formatCurrency(account.balance)}</span>
                </div>
                <button class="delete-btn" data-id="${account.id}"><i class="fa-solid fa-trash"></i></button>
            `;
            accountList.appendChild(li);
            
            // Adicionar event listener ao botão de excluir
            li.querySelector('.delete-btn').addEventListener('click', function() {
                const accountId = parseInt(this.getAttribute('data-id'));
                deleteAccount(accountId);
            });
            
            updateAccountBalances();
            
            showNotification('Conta adicionada com sucesso!', 'success');
        }
        
        function deleteAccount(accountId) {
            // Verificar se a conta está sendo usada em transações
            const isUsed = transactions.some(t => t.accountId === accountId);
            
            if (isUsed) {
                showNotification('Não é possível excluir uma conta que está sendo usada em transações.', 'error');
                return;
            }
            
            const accountIndex = accounts.findIndex(a => a.id === accountId);
            
            if (accountIndex === -1) return;
            
            accounts.splice(accountIndex, 1);
            
            saveData();
            populateAccounts();
            
            // Remover da lista
            document.querySelectorAll('#account-list .list-item').forEach(item => {
                if (parseInt(item.querySelector('.delete-btn').getAttribute('data-id')) === accountId) {
                    item.remove();
                }
            });
            
            updateAccountBalances();
            
            showNotification('Conta excluída com sucesso!', 'success');
        }
        
        function addGoal(e) {
            e.preventDefault();
            
            const name = document.getElementById('goal-name').value;
            const target = parseFloat(document.getElementById('goal-target').value);
            const deadline = document.getElementById('goal-deadline').value;
            const initialAmount = parseFloat(document.getElementById('goal-initial-amount').value) || 0;
            const description = document.getElementById('goal-description').value;
            
            if (!name.trim() || target <= 0) return;
            
            const goal = {
                id: nextGoalId++,
                name: name.trim(),
                target,
                currentAmount: initialAmount,
                deadline,
                description
            };
            
            goals.push(goal);
            
            saveData();
            document.getElementById('goal-form').reset();
            updateGoalsList();
            updateDashboardCards();
            
            showNotification('Meta criada com sucesso!', 'success');
        }
        
        function deleteGoal(goalId) {
            const goalIndex = goals.findIndex(g => g.id === goalId);
            
            if (goalIndex === -1) return;
            
            goals.splice(goalIndex, 1);
            
            saveData();
            updateGoalsList();
            updateDashboardCards();
            
            showNotification('Meta excluída com sucesso!', 'success');
        }
        
        function processGoalTransfer(e) {
            e.preventDefault();
            
            const goalId = parseInt(document.getElementById('transfer-goal-id').value);
            const amount = parseFloat(document.getElementById('transfer-amount').value);
            const fromAccountId = parseInt(document.getElementById('transfer-from').value);
            
            const goalIndex = goals.findIndex(g => g.id === goalId);
            const accountIndex = accounts.findIndex(a => a.id === fromAccountId);
            
            if (goalIndex === -1 || accountIndex === -1) return;
            
            const goal = goals[goalIndex];
            const account = accounts[accountIndex];
            
            // Verificar se há saldo suficiente na conta
            if (account.balance < amount) {
                showNotification('Saldo insuficiente na conta selecionada.', 'error');
                return;
            }
            
            // Atualizar valores
            goal.currentAmount += amount;
            account.balance -= amount;
            
            // Registrar transação de transferência
            const transaction = {
                id: nextTransactionId++,
                description: `Transferência para meta: ${goal.name}`,
                amount: -amount,
                date: formatDate(new Date()),
                categoryId: 9, // Outros
                accountId: fromAccountId,
                isPending: false
            };
            
            transactions.push(transaction);
            
            saveData();
            updateUI();
            hideTransferModal();
            
            showNotification(`Valor de ${formatCurrency(amount)} transferido para a meta com sucesso!`, 'success');
        }
        
        // ========== FUNÇÕES DE RELATÓRIOS ==========
        function updateReports() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const categoryFilter = document.getElementById('category-filter').value;
            
            // Filtrar transações
            let filteredTransactions = transactions.filter(t => {
                if (t.isPending) return false;
                
                const transactionDate = new Date(t.date);
                const start = startDate ? new Date(startDate) : new Date('1900-01-01');
                const end = endDate ? new Date(endDate) : new Date();
                end.setHours(23, 59, 59, 999); // Fim do dia
                
                return transactionDate >= start && transactionDate <= end;
            });
            
            if (categoryFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.categoryId === parseInt(categoryFilter));
            }
            
            // Calcular totais
            const totalIncome = filteredTransactions
                .filter(t => t.amount > 0)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = filteredTransactions
                .filter(t => t.amount < 0)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const netAmount = totalIncome + totalExpense;
            
            // Atualizar resumo
            const reportSummary = document.getElementById('report-summary');
            reportSummary.innerHTML = `
                <div class="report-card card">
                    <div class="card-header">
                        <span>Receitas</span>
                        <i class="fa-solid fa-arrow-up"></i>
                    </div>
                    <p style="color: var(--success-color);">${formatCurrency(totalIncome)}</p>
                </div>
                <div class="report-card card">
                    <div class="card-header">
                        <span>Despesas</span>
                        <i class="fa-solid fa-arrow-down"></i>
                    </div>
                    <p style="color: var(--danger-color);">${formatCurrency(Math.abs(totalExpense))}</p>
                </div>
                <div class="report-card card">
                    <div class="card-header">
                        <span>Saldo Líquido</span>
                        <i class="fa-solid fa-balance-scale"></i>
                    </div>
                    <p style="color: ${netAmount >= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">${formatCurrency(netAmount)}</p>
                </div>
            `;
            
            // Atualizar gráficos
            updateExpenseChart(filteredTransactions);
            updateFlowChart(filteredTransactions, startDate, endDate);
        }
        
        function updateExpenseChart(transactions) {
            const expenseTransactions = transactions.filter(t => t.amount < 0);
            
            // Agrupar por categoria
            const categoryExpenses = {};
            expenseTransactions.forEach(transaction => {
                const category = categories.find(c => c.id === transaction.categoryId);
                const categoryName = category ? category.name : 'Outros';
                
                if (!categoryExpenses[categoryName]) {
                    categoryExpenses[categoryName] = 0;
                }
                
                categoryExpenses[categoryName] += Math.abs(transaction.amount);
            });
            
            const ctx = document.getElementById('expense-chart').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (window.expenseChart) {
                window.expenseChart.destroy();
            }
            
            window.expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryExpenses),
                    datasets: [{
                        data: Object.values(categoryExpenses),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Distribuição de Despesas por Categoria'
                        }
                    }
                }
            });
        }
        
        function updateFlowChart(transactions, startDate, endDate) {
            // Agrupar por data (mensalmente)
            const monthlyData = {};
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = { income: 0, expense: 0 };
                }
                
                if (transaction.amount > 0) {
                    monthlyData[monthKey].income += transaction.amount;
                } else {
                    monthlyData[monthKey].expense += Math.abs(transaction.amount);
                }
            });
            
            // Ordenar por data
            const sortedMonths = Object.keys(monthlyData).sort();
            
            const labels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                return `${monthNum}/${year}`;
            });
            
            const incomeData = sortedMonths.map(month => monthlyData[month].income);
            const expenseData = sortedMonths.map(month => monthlyData[month].expense);
            
            const ctx = document.getElementById('flow-chart').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (window.flowChart) {
                window.flowChart.destroy();
            }
            
            window.flowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: incomeData,
                            backgroundColor: 'rgba(18, 164, 84, 0.7)',
                            borderColor: 'rgba(18, 164, 84, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            backgroundColor: 'rgba(232, 63, 91, 0.7)',
                            borderColor: 'rgba(232, 63, 91, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Receitas vs. Despesas ao Longo do Tempo'
                        }
                    }
                }
            });
        }
        
        function downloadReportPDF() {
            // Esta função usaria uma biblioteca como jsPDF para gerar um PDF
            // Por simplicidade, vamos apenas simular o download
            showNotification('Relatório PDF gerado com sucesso!', 'success');
            
            // Em uma implementação real, você usaria:
            // const { jsPDF } = window.jspdf;
            // const doc = new jsPDF();
            // ... adicionar conteúdo ao PDF ...
            // doc.save('relatorio-financeiro.pdf');
        }
        
        function downloadReceipt() {
            const transactionId = parseInt(document.getElementById('edit-transaction-id').value);
            const transaction = transactions.find(t => t.id === transactionId);
            
            if (!transaction) return;
            
            const category = categories.find(c => c.id === transaction.categoryId);
            const account = accounts.find(a => a.id === transaction.accountId);
            
            // Em uma implementação real, você geraria um PDF com os detalhes da transação
            // Por simplicidade, vamos apenas simular o download
            showNotification('Recibo PDF gerado com sucesso!', 'success');
            
            // Em uma implementação real, você usaria:
            // const { jsPDF } = window.jspdf;
            // const doc = new jsPDF();
            // ... adicionar conteúdo do recibo ...
            // doc.save(`recibo-${transaction.id}.pdf`);
        }
        
        // ========== FUNÇÕES DE BACKUP ==========
        function createBackup() {
            const data = {
                transactions,
                categories,
                accounts,
                goals,
                nextTransactionId,
                nextCategoryId,
                nextAccountId,
                nextGoalId,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-financeiro-${formatDate(new Date(), 'backup')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Backup criado com sucesso!', 'success');
        }
        
        function downloadAllData() {
            const data = {
                transactions,
                categories,
                accounts,
                goals,
                nextTransactionId,
                nextCategoryId,
                nextAccountId,
                nextGoalId,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dados-financeiros-completos-${formatDate(new Date(), 'backup')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Todos os dados foram baixados com sucesso!', 'success');
        }
        
        function enableRestoreButton() {
            const fileInput = document.getElementById('restore-file');
            const restoreBtn = document.getElementById('restore-btn');
            const restoreStatus = document.getElementById('restore-status');
            
            if (fileInput.files.length > 0) {
                restoreBtn.disabled = false;
                restoreStatus.textContent = `Arquivo selecionado: ${fileInput.files[0].name}`;
                restoreStatus.style.color = 'var(--success-color)';
            } else {
                restoreBtn.disabled = true;
                restoreStatus.textContent = '';
            }
        }
        
        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            
            if (fileInput.files.length === 0) {
                showNotification('Nenhum arquivo selecionado.', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validar estrutura dos dados
                    if (!data.transactions || !data.categories || !data.accounts) {
                        throw new Error('Formato de arquivo inválido.');
                    }
                    
                    // Restaurar dados
                    transactions = data.transactions;
                    categories = data.categories;
                    accounts = data.accounts;
                    goals = data.goals || [];
                    nextTransactionId = data.nextTransactionId || transactions.length + 1;
                    nextCategoryId = data.nextCategoryId || categories.length + 1;
                    nextAccountId = data.nextAccountId || accounts.length + 1;
                    nextGoalId = data.nextGoalId || goals.length + 1;
                    
                    saveData();
                    initializeApp();
                    
                    showNotification('Dados restaurados com sucesso!', 'success');
                    
                    // Limpar seleção de arquivo
                    fileInput.value = '';
                    document.getElementById('restore-btn').disabled = true;
                    document.getElementById('restore-status').textContent = '';
                    
                } catch (error) {
                    console.error('Erro ao restaurar dados:', error);
                    showNotification('Erro ao restaurar dados. Verifique se o arquivo é válido.', 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // ========== FUNÇÕES AUXILIARES ==========
        function populateCategories(selectId = 'category') {
            const select = document.getElementById(selectId);
            const filterSelect = document.getElementById('category-filter');
            
            if (!select) return;
            
            select.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                select.appendChild(option);
            });
            
            // Atualizar também o select de filtro se estiver na página de relatórios
            if (filterSelect) {
                filterSelect.innerHTML = '<option value="">Todas as categorias</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    filterSelect.appendChild(option);
                });
            }
            
            // Atualizar lista de categorias na página de gerenciamento
            if (selectId === 'category') {
                const categoryList = document.getElementById('category-list');
                categoryList.innerHTML = '';
                
                categories.forEach(category => {
                    const li = document.createElement('li');
                    li.className = 'list-item';
                    li.innerHTML = `
                        <div class="list-item-main">
                            <i class="fa-solid fa-tag"></i>
                            <span>${category.name}</span>
                        </div>
                        <button class="delete-btn" data-id="${category.id}"><i class="fa-solid fa-trash"></i></button>
                    `;
                    categoryList.appendChild(li);
                    
                    // Adicionar event listener ao botão de excluir
                    li.querySelector('.delete-btn').addEventListener('click', function() {
                        const categoryId = parseInt(this.getAttribute('data-id'));
                        deleteCategory(categoryId);
                    });
                });
            }
        }
        
        function populateAccounts(selectId = 'account') {
            const select = document.getElementById(selectId);
            const transferFromSelect = document.getElementById('transfer-from');
            
            if (!select) return;
            
            select.innerHTML = '';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = `${account.name} (${formatCurrency(account.balance)})`;
                select.appendChild(option);
            });
            
            // Atualizar também o select de transferência se estiver na página de metas
            if (transferFromSelect) {
                transferFromSelect.innerHTML = '';
                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = `${account.name} (${formatCurrency(account.balance)})`;
                    transferFromSelect.appendChild(option);
                });
            }
            
            // Atualizar lista de contas na página de gerenciamento
            if (selectId === 'account') {
                const accountList = document.getElementById('account-list');
                accountList.innerHTML = '';
                
                accounts.forEach(account => {
                    const li = document.createElement('li');
                    li.className = 'list-item';
                    li.innerHTML = `
                        <div class="list-item-main">
                            <i class="fa-solid fa-credit-card"></i>
                            <span>${account.name} - ${formatCurrency(account.balance)}</span>
                        </div>
                        <button class="delete-btn" data-id="${account.id}"><i class="fa-solid fa-trash"></i></button>
                    `;
                    accountList.appendChild(li);
                    
                    // Adicionar event listener ao botão de excluir
                    li.querySelector('.delete-btn').addEventListener('click', function() {
                        const accountId = parseInt(this.getAttribute('data-id'));
                        deleteAccount(accountId);
                    });
                });
            }
        }
        
        function updateAccountBalance(accountId, amount) {
            const accountIndex = accounts.findIndex(a => a.id === accountId);
            
            if (accountIndex !== -1) {
                accounts[accountIndex].balance += amount;
                saveData();
            }
        }
        
        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('goals', JSON.stringify(goals));
            localStorage.setItem('nextTransactionId', nextTransactionId.toString());
            localStorage.setItem('nextCategoryId', nextCategoryId.toString());
            localStorage.setItem('nextAccountId', nextAccountId.toString());
            localStorage.setItem('nextGoalId', nextGoalId.toString());
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(amount);
        }
        
        function formatDate(date, format = 'input') {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            
            if (format === 'input') {
                return `${year}-${month}-${day}`;
            } else if (format === 'backup') {
                return `${year}${month}${day}`;
            }
            
            return `${day}/${month}/${year}`;
        }
        
        function formatDateDisplay(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }
        
        function showNotification(message, type = 'info') {
            // Criar elemento de notificação
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Estilos da notificação
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.padding = '12px 20px';
            notification.style.borderRadius = '5px';
            notification.style.color = 'white';
            notification.style.fontWeight = '500';
            notification.style.zIndex = '10000';
            notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            notification.style.transform = 'translateX(100%)';
            notification.style.transition = 'transform 0.3s ease';
            
            // Cor de fundo baseada no tipo
            if (type === 'success') {
                notification.style.backgroundColor = 'var(--success-color)';
            } else if (type === 'error') {
                notification.style.backgroundColor = 'var(--danger-color)';
            } else {
                notification.style.backgroundColor = 'var(--pending-color)';
            }
            
            document.body.appendChild(notification);
            
            // Animar entrada
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Remover após 3 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
